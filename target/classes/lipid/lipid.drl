package lipid;

unit LipidScoreUnit;

// Rule 1: Score 1 for lipid pair with increasing RT and carbon count
rule "Score 1 for lipid pair with increasing RT and carbon count"
salience 10  // Ensure this rule has higher priority
when
    $a1 : /annotations [
        $rt1 : rtMin,
        $carbonCount1 : lipid.getCarbonCount(),
        $doubleBondCount : lipid.getDoubleBondsCount(),
        $lipidType : lipid.getLipidType()
    ]
    $a2 : /annotations [
        this != $a1,
        lipid.getDoubleBondsCount() == $doubleBondCount,
        lipid.getLipidType() == $lipidType,
        rtMin > $rt1,
        lipid.getCarbonCount() > $carbonCount1
    ]
then
    $a1.addScore(1.0d);  // Positive score for both annotations
    $a2.addScore(1.0d);  // Positive score for both annotations
    System.out.println("Scored 1 for annotations: " + $a1 + " and " + $a2);
end

// Rule 2: Score 1 for lipid pair with increasing RT and double bonds
rule "Score 1 for lipid pair with increasing RT and double bonds"
salience 9  // Slightly lower priority than Rule 1
when
    $a1 : /annotations [
        $rt1 : rtMin,
        $carbonCount1 : lipid.getCarbonCount(),
        $doubleBondCount : lipid.getDoubleBondsCount(),
        $lipidType : lipid.getLipidType()
    ]
    $a2 : /annotations [
        this != $a1,
        lipid.getDoubleBondsCount() < $doubleBondCount,
        lipid.getLipidType() == $lipidType,
        rtMin > $rt1,
        lipid.getCarbonCount() == $carbonCount1
    ]
then
    $a1.addScore(1.0d);  // Positive score for both annotations
    $a2.addScore(1.0d);  // Positive score for both annotations
    System.out.println("Scored 1 for annotations: " + $a1 + " and " + $a2);
end

// Rule 3: Score 1 for lipid pair with increasing RT and lipid type
rule "Score 1 for lipid pair with increasing RT and lipid type"
salience 8  // Lower priority to avoid conflict with other rules
when
    $a1 : /annotations [
        $rt1 : rtMin,
        $carbonCount1 : lipid.getCarbonCount(),
        $doubleBondCount : lipid.getDoubleBondsCount(),
        $lipidType : lipid.getLipidType()
    ]
    $a2 : /annotations [
        this != $a1,
        lipid.getDoubleBondsCount() == $doubleBondCount,
        lipid.getLipidType() != $lipidType,
        rtMin > $rt1,
        lipid.getCarbonCount() == $carbonCount1
    ]
then
    $a1.addScore(1.0d);  // Positive score for both annotations
    $a2.addScore(1.0d);  // Positive score for both annotations
    System.out.println("Scored 1 for annotations: " + $a1 + " and " + $a2);
end

// Rule 4: Negative evidence if RT follows opposite order to previous based on RT and carbon count
rule "Negative evidence if RT follows opposite order to previous based on RT and carbon count"
salience 7  // Lower priority
when
    $a1 : /annotations [
        $rt1 : rtMin,
        $carbonCount1 : lipid.getCarbonCount(),
        $doubleBondCount : lipid.getDoubleBondsCount(),
        $lipidType : lipid.getLipidType()
    ]
    $a2 : /annotations [
        this != $a1,
        lipid.getLipidType() == $lipidType,
        lipid.getCarbonCount() < $carbonCount1,
        rtMin < $rt1,
        lipid.getDoubleBondsCount() == $doubleBondCount
    ]
then
    $a1.addScore(-1.0d);  // Negative score for both annotations
    $a2.addScore(-1.0d);  // Negative score for both annotations
    System.out.println("Scored -1 for annotations: " + $a1 + " and " + $a2);
end

// Rule 5: Negative evidence if RT follows opposite order to previous based on RT and double bonds
rule "Negative evidence if RT follows opposite order to previous based on RT and double bonds"
salience 6  // Lower priority
when
    $a1 : /annotations [
        $rt1 : rtMin,
        $carbonCount1 : lipid.getCarbonCount(),
        $doubleBondCount : lipid.getDoubleBondsCount(),
        $lipidType : lipid.getLipidType()
    ]
    $a2 : /annotations [
        this != $a1,
        lipid.getLipidType() == $lipidType,
        lipid.getCarbonCount() == $carbonCount1,
        rtMin < $rt1,
        lipid.getDoubleBondsCount() < $doubleBondCount
    ]
then
    $a1.addScore(-1.0d);  // Negative score for both annotations
    $a2.addScore(-1.0d);  // Negative score for both annotations
    System.out.println("Scored -1 for annotations: " + $a1 + " and " + $a2);
end

// Rule 6: Negative evidence if RT follows opposite order to previous based on lipid type
rule "Negative evidence if RT follows opposite order to previous based on lipid type"
salience 5  // Lower priority
when
    $a1 : /annotations [
        $rt1 : rtMin,
        $carbonCount1 : lipid.getCarbonCount(),
        $doubleBondCount : lipid.getDoubleBondsCount(),
        $lipidType : lipid.getLipidType()
    ]
    $a2 : /annotations [
        this != $a1,
        lipid.getDoubleBondsCount() == $doubleBondCount,
        lipid.getLipidType() == $lipidType,
        rtMin < $rt1,
        lipid.getCarbonCount() > $carbonCount1
    ]
then
    $a1.addScore(-1.0d);  // Negative score for both annotations
    $a2.addScore(-1.0d);  // Negative score for both annotations
    System.out.println("Scored -1 for annotations: " + $a1 + " and " + $a2);
end
